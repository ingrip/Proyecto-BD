{% extends "base.html" %}
{% block title %}Perfil — {{ usuario }}{% endblock %}
{% block content %}

<style>
  body {
    background: linear-gradient(135deg, var(--p1), var(--p3));
    font-family: 'Poppins', sans-serif;
    color: #3b3a3a;
  }

  .card {
    border: none;
    border-radius: 12px;
    background-color: rgba(255, 255, 255, 0.95);
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }

  .btn-dark {
    background-color: #3b3a3a;
    border: none;
  }

  .btn-dark:hover {
    background-color: #b7a192;
    color: #3b3a3a;
  }

  .btn-outline-danger {
    border-color: #f0a790;
    color: #f0a790;
  }

  .btn-outline-danger:hover {
    background-color: #f0a790;
    color: white;
  }

  .back-btn {
    background-color: #fed0bd;
    border: none;
    color: #3b3a3a;
    transition: 0.3s;
  }

  .back-btn:hover {
    background-color: #f0a790;
    color: white;
  }

</style>

<div class="container py-4">

  <!-- Mostrar alerts -->
 

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold">Perfil de {{ usuario }}</h3>
    <a href="{{ url_for('categorias') }}" class="btn back-btn">
      ← Volver a categorías
    </a>
  </div>

  <div class="row g-4">
    <!-- Panel de perfil -->
    <div class="col-12 col-md-4">
      <div class="card p-4">
        <div class="text-center mb-3">
          <div class="rounded-circle bg-light mx-auto mb-2"
               style="width:90px;height:90px;display:flex;align-items:center;justify-content:center;font-size:40px;color:#6c757d;">
            <i class="bi bi-person"></i>
          </div>
          <h5 class="fw-bold mb-0">{{ usuario }}</h5>
          <small class="text-muted">Mi cuenta personal</small>
        </div>

        <hr>

        <form method="POST" class="mb-3">
          <h6 class="fw-semibold mb-2">Cambiar contraseña</h6>
          <div class="input-group mb-3">
            <input type="password" name="nueva" id="nueva" class="form-control" placeholder="Nueva contraseña" required>
            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword()">
              <i id="icon-eye" class="bi bi-eye"></i>
            </button>
          </div>
          <button class="btn btn-dark w-100">Actualizar</button>
        </form>

        <hr>

        <form method="POST" onsubmit="return confirm('¿Eliminar tu cuenta? Esto borrará todo.');">
          <input type="hidden" name="eliminar" value="1">
          <button class="btn btn-outline-danger w-100">Eliminar cuenta</button>
        </form>
      </div>
    </div>

    <!-- Panel derecho -->
    <div class="col-12 col-md-8">
      <div class="card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Tus artículos</h5>
          <small class="text-muted">{{ articulos|length }} publicados</small>
        </div>

        {% if articulos %}
          <div class="list-group list-group-flush">
            {% for art in articulos %}
              <div class="list-group-item px-0 py-2 d-flex justify-content-between align-items-start border-0 border-bottom">
                <div>
                  <a href="{{ url_for('articulo', id=art[0]) }}" class="fw-semibold text-decoration-none text-dark">
                    {{ art[1] }}
                  </a>
                  <div class="small text-muted">{{ art[4] if art|length>4 else '' }}</div>
                </div>
                <a href="{{ url_for('eliminar_articulo_route', id=art[0]) }}"
                   class="btn btn-sm btn-outline-danger"
                   onclick="return confirm('¿Eliminar artículo?')">
                  <i class="bi bi-trash"></i>
                </a>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-muted fst-italic">No tienes artículos publicados.</div>
        {% endif %}
      </div>

      <div class="card p-4">
        <h5 class="fw-bold mb-3">Crear nuevo artículo</h5>
        <form method="POST">
          <input type="hidden" name="crear" value="1">

          <div class="mb-3">
            <input class="form-control" name="titulo" placeholder="Título" required>
          </div>

          <div class="mb-3">
            <textarea class="form-control" name="contenido" placeholder="Contenido" rows="4" required></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label small text-muted">Categorías</label>
            <div class="d-flex flex-wrap gap-2">
              {% for c in categorias %}
                <label class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" name="categorias" value="{{ c }}">
                  <span class="form-check-label">{{ c }}</span>
                </label>
              {% endfor %}
            </div>
          </div>

          <div class="mb-3">
            <input class="form-control" name="tags" placeholder="Tags (separados por coma)">
          </div>

          <div class="text-end">
            <button class="btn btn-dark px-4">Publicar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function togglePassword() {
  const input = document.getElementById("nueva");
  const icon = document.getElementById("icon-eye");
  if (input.type === "password") {
    input.type = "text";
    icon.classList.replace("bi-eye", "bi-eye-slash");
  } else {
    input.type = "password";
    icon.classList.replace("bi-eye-slash", "bi-eye");
  }
}
</script>

{% endblock %}
